---
title: "Presidential Election Finance Data"
author: "Sarah Edelson, Seamus Lawton, Matthew Perkins"
output:
  prettydoc::html_pretty:
    theme: architect
    thumbnails: false
    highlight: NULL
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align="center")
library(tidyverse)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(rvest)
library(here)
library(readr)
library(ggnetwork)
library(datasets)
library(mdsr)
library(gapminder)
library(igraph)
library(maps)
library(scales)
library(DT)
```

# Header 1

## Header 2

### Header 3

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For example, you can include **Bold** and _Italic_ and `Code` text.  For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

You should test out updating your GitHub Pages website:

- clone your group's blog project repo in RStudio
- update "Your Project Title Here" to a new title in the YAML header
- knit `index.Rmd` 
- commit and push BOTH the `index.Rmd` and the `index.html` files
- go to https://stat231-s21.github.io/Blog-Nate-Platinum/ to see the published test document (this is publicly available!)

## Including code and plots

You can embed code as normal, for example:

```{r cars}
summary(cars)
```

Let's clean up the format of that output:

In a study from the 1920s, fifty cars were used to see how the speed of the car and the distance taken to stop were related.  Speeds ranged between `r min(cars$speed)` and `r max(cars$speed)` mph.  Distances taken to stop ranged between `r min(cars$dist)` and `r max(cars$dist)` feet, with the middle 50% falling between `r as.numeric(quantile(cars$dist)[2])` and `r as.numeric(quantile(cars$dist)[4])` feet.  

You can also embed plots as normal, for example:

## Independent Expenditures for Joe Biden & Donald Trump


```{r fig.width = 35, fig.height = 15, message = FALSE, echo=FALSE}
independent_expenditures <- read_csv(here("Data", "IndependentExpenditures.csv"))

independent_expenditures <- independent_expenditures %>%
  mutate(candidate_cleaned_ie = (case_when(
         str_detect(candidate_name, "BIDEN, JOSEPH R JR") ~ "Joe Biden",
         str_detect(candidate_name, "BLOOMBERG, MICHAEL R.") ~ "Michael Bloomberg",
         str_detect(candidate_name, "HARRIS, KAMALA D.") ~ "Kamala Harris",
         str_detect(candidate_name, "KLOBUCHAR, AMY J.") ~ "Amy Klobuchar",
         str_detect(candidate_name, "SANDERS, BERNARD") ~ "Bernie Sanders",
         str_detect(candidate_name, "STEYER, TOM") ~ "Tom Steyer",
         str_detect(candidate_name, "TRUMP, DONALD J.") ~ "Donald Trump",
         str_detect(candidate_name, "WARREN, ELIZABETH") ~ "Elizabeth Warren",
         str_detect(candidate_name, "YANG, ANDREW MR.") ~ "Andrew Yang"
         )))
  

independent_expenditures_large <- independent_expenditures %>%
  mutate(committee_cleaned = (case_when(
         str_detect(committee_name, "DEFENDING DEMOCRACY TOGETHER") ~ (paste("DEFENDING", "DEMOCRACY", "TOGETHER", sep="\n")),
         str_detect(committee_name, "AB PAC") ~ "AB PAC",
         str_detect(committee_name, "THE LINCOLN PROJECT") ~ "THE LINCOLN PROJECT",
         str_detect(committee_name, "GREAT AMERICA PAC") ~ (paste("GREAT AMERICA", "PAC.", sep="\n")),
         str_detect(committee_name, "THE COMMITTEE TO DEFEND THE PRESIDENT") ~ (paste("THE COMMITTEE", "TO DEFEND", "THE PRESIDENT", sep = "\n")),
         str_detect(committee_name, "LCV VICTORY FUND") ~ (paste("LCV VICTORY", "FUND", sep="\n")),
         str_detect(committee_name, "PRIORITIES USA ACTION") ~ (paste("PRIORITIES USA", "ACTION", sep="\n")),
         str_detect(committee_name, "FF PAC") ~ "FF PAC",
         str_detect(committee_name, "INDEPENDENCE USA PAC") ~ "INDEPENDENCE USA PAC",
         str_detect(committee_name, "BLACK PAC") ~ "BLACK PAC",
         str_detect(committee_name, "RESTORATION PAC") ~ "RESTORATION PAC",
         str_detect(committee_name, "AMERICA FIRST ACTION, INC.") ~ "AMERICA FIRST ACTION, INC.",
         str_detect(committee_name, "UNITE THE COUNTRY") ~ "UNITE THE COUNTRY",
         str_detect(committee_name, "NRA VICTORY FUND, INC.") ~ (paste("NRA VICTORY", "FUND, INC.", sep="\n")),
         str_detect(committee_name, "CLUB FOR GROWTH ACTION") ~ (paste("CLUB FOR", "GROWTH ACTION", sep="\n")),
         str_detect(committee_name, "NEXTGEN CLIMATE ACTION COMMITTEE") ~ (paste("NEXTGEN", "CLIMATE", "ACTION", "COMMITTEE", sep="\n")),
         str_detect(committee_name, "PRESERVE AMERICA PAC") ~ paste("PRESERVE AMERICA", "PAC", sep="\n"))
         ))

independent_expenditures_large <- independent_expenditures_large %>%
  select(committee_cleaned, candidate_cleaned_ie, total, support_oppose_indicator) %>%
  filter(total > 10000000)  %>%
  filter(candidate_cleaned_ie == "Donald Trump" | candidate_cleaned_ie == "Joe Biden")

set.seed(15)
g_expenditures <- graph_from_data_frame(independent_expenditures_large, directed = TRUE)

expenditures_network <- ggnetwork(g_expenditures) %>%
  mutate(candidate = case_when(name == "Donald Trump" ~ "Donald Trump", 
                               name == "Joe Biden" ~ "Joe Biden",
                               TRUE ~ ""))


# Color by support or oppose
ggplot(data = expenditures_network, aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_edges(aes(size = total/1000000, color = support_oppose_indicator)) + geom_nodes() +
  geom_nodelabel(data = filter(expenditures_network, name!= "Donald Trump" & name != "Joe Biden"), aes(label = name), color = "black", size = 10) +
  geom_nodelabel(data = filter(expenditures_network, name == "Donald Trump"), aes(label = name), color = "blue", size = 14) +
  geom_nodelabel(data = filter(expenditures_network, name == "Joe Biden"), aes(label = name), color = "blue", size = 14) +
  theme_blank() +
  scale_color_manual(values=c("red2", "slategray")) +
  labs(size = "Contribution Size (millions)") +
  labs(color = "Support or Oppose Candidate") +
  ggtitle("Independent Expenditures Over 10 million") +
  theme(plot.title = element_text(size = 40)) +
  theme(legend.title = element_text(size = 40)) +
  theme(legend.text = element_text(size = 40)) +
  theme(legend.position = "bottom") +
  guides(color = guide_legend(override.aes = list(size = 5)))
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

## All Independent Expenditures

```{r pretty, echo=FALSE, warning=FALSE, message=FALSE, fig.width = 30}
independent_expenditures %>%
  select(candidate_name, committee_name, total, support_oppose_indicator) %>%
  arrange(desc(total)) %>%
  datatable(
    head(iris)
    )
```

## Individual Contributions
```{r}
knitr::include_app("http://sedelson31.shinyapps.io/IndividualContributionsMap")
```


## Including links and images

You can include [Links](https://www.datadreaming.org/post/r-markdown-theme-gallery/) and images ![team logo](https://raw.githubusercontent.com/stat231-s21/Blog-Nate-Platinum/main/images/S1-politics.jpg)

You can embed a gif.

![pugs](https://media.giphy.com/media/XHVmD4RyXgSjd8aUMb/giphy.gif)

# You can even create tabs if you want! {.tabset .tabset-fade .tabset-pills}

## Bulleted list

You can make a bulleted list like this:

- item 1
- item 2
- item 3


## Numbered list

You can make a numbered list like this

1. First thing I want to say
2. Second thing I want to say
3. Third thing I want to say

